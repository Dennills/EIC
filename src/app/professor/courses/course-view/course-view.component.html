<div class="course-view-container">
  <div class="course-header">
    <button class="btn-back" (click)="goBack()">
      â† Volver a Mis Cursos
    </button>

    <div class="course-info">
      <h1>{{ course.name }}</h1>
      <div class="course-meta">
        <span class="meta-item">ğŸ“š {{ course.code }}</span>
        <span class="meta-item">ğŸ“… {{ course.semester }}</span>
        <span class="meta-item">ğŸ‘¥ {{ course.students }} estudiantes</span>
      </div>
    </div>
  </div>

  <div class="action-buttons">
    <!-- BotÃ³n Ver Asistencia -->
    <button class="btn-attendance" (click)="viewAttendance()">
      ğŸ“… Ver Asistencia
    </button>

    <!-- ğŸ“„ BotÃ³n Generar Reporte (solo para PrÃ¡cticas Preprofesionales) -->
    <button 
      *ngIf="isPracticasPreprofesionales()"
      class="btn-generate-report"
      [class.generating]="generatingReport"
      [class.generated]="reportGenerated"
      [disabled]="generatingReport || reportGenerated"
      (click)="generateReport()">
      <mat-icon *ngIf="!generatingReport && !reportGenerated">description</mat-icon>
      <mat-icon *ngIf="generatingReport" class="spinning">hourglass_empty</mat-icon>
      <mat-icon *ngIf="reportGenerated">check_circle</mat-icon>
      <span *ngIf="!generatingReport && !reportGenerated">ğŸ“„ Generar Reporte</span>
      <span *ngIf="generatingReport">â³ Generando Reporte...</span>
      <span *ngIf="reportGenerated">âœ… Reporte Generado</span>
    </button>

    <!-- ğŸ“Š BotÃ³n Power BI (solo para PrÃ¡cticas Preprofesionales y despuÃ©s del reporte) -->
    <button 
      *ngIf="isPracticasPreprofesionales()"
      class="power-bi-button"
      [class.disabled]="!reportGenerated"
      [disabled]="!reportGenerated"
      (click)="togglePowerBI()">
      <mat-icon>{{ !reportGenerated ? 'lock' : (showPowerBI ? 'visibility_off' : 'analytics') }}</mat-icon>
      <span *ngIf="!reportGenerated">ğŸ”’ Dashboard Bloqueado</span>
      <span *ngIf="reportGenerated">{{ showPowerBI ? 'Ocultar Dashboard' : 'ğŸ“Š Ver Dashboard ' }}</span>
    </button>
  </div>

  <!-- ğŸ“Š IFRAME DE POWER BI EMBEBIDO -->
  <div *ngIf="isPracticasPreprofesionales() && showPowerBI && reportGenerated" class="powerbi-container">
    <div class="powerbi-header">
      <h3>ğŸ“Š Dashboard  - {{ course.name }}</h3>
      <button class="btn-close-powerbi" (click)="togglePowerBI()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
    <iframe 
      [src]="safePowerBiUrl"
      frameborder="0" 
      allowFullScreen="true"
      class="powerbi-iframe">
    </iframe>
  </div>

  <!-- Lista de Estudiantes -->
  <div class="students-section">
    <h2>ğŸ‘¨â€ğŸ“ Estudiantes del Curso</h2>
    
    <div class="students-list-vertical">
      <div 
        *ngFor="let student of students; let i = index"
        class="student-item-vertical">
        
        <div class="student-number">
          {{ i + 1 }}
        </div>
        
        <div class="student-avatar">
          {{ student.name.charAt(0) }}
        </div>
        
        <div class="student-details">
          <h3>{{ student.name }}</h3>
          <p>CÃ³digo: {{ student.code }}</p>
        </div>

        <button 
          *ngIf="isPracticasPre"
          class="btn-evaluate-ia"
          (click)="evaluateStudent(student.id)">
          ğŸ¤– Evaluar con IA
        </button>

        <span *ngIf="!isPracticasPre" class="student-status">
          âœ… Activo
        </span>
      </div>
    </div>
  </div>
</div>